<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø£Ø­ÙŠØ§Ø¡ - Ø´Ø±Ø­ Ù…Ø¨Ø³Ø·ØŒ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ ÙƒØªØ¨ ÙˆÙ…Ù„Ø§Ø²Ù… Ù…Ø¬Ø§Ù†ÙŠØ©ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©.">
    <meta name="keywords" content="Ø£Ø­ÙŠØ§Ø¡, Ø«Ø§Ù†ÙˆÙŠØ© Ø¹Ø§Ù…Ø©, Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡, Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©, Ø´Ø±Ø­ Ø£Ø­ÙŠØ§Ø¡, Ù…Ø±Ø§Ø¬Ø¹Ø§Øª, Ø§Ù…ØªØ­Ø§Ù†Ø§Øª, ÙƒØªØ¨ pdf">
    <title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø§Ù„Ø¯ÙƒØªÙˆØ±</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&family=Reem+Kufi:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="manifest" href="manifest.json">
    <link rel="preload" as="image" href="6.jpeg">
    <style>
        @media (max-width: 992px) {
            .grid-container.grid-3 {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .hero {
                height: auto;
                min-height: 100vh;
                padding: 120px 20px 60px;
            }
            .hero h1 {
                font-size: 2.5rem !important;
                line-height: 1.3;
            }
            .hero-desc {
                width: 100%;
                font-size: 1rem;
                margin: 0 auto 30px;
            }
            .hero-btns {
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }
            .grid-container.grid-3 {
                gap: 25px;
                padding-top: 30px !important;
            }
        }
    </style>
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "Ù…Ù†ØµØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø£Ø­ÙŠØ§Ø¡",
      "url": "https://abqarieno.firebaseapp.com/index.html",
      "logo": "https://abqarieno.firebaseapp.com/212.png",
      "description": "Ù…Ù†ØµØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø£Ø­ÙŠØ§Ø¡ - Ø´Ø±Ø­ Ù…Ø¨Ø³Ø·ØŒ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ ÙƒØªØ¨ ÙˆÙ…Ù„Ø§Ø²Ù… Ù…Ø¬Ø§Ù†ÙŠØ©ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©.",
      "founder": {
        "@type": "Person",
        "name": "Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡",
        "jobTitle": "Ù…Ø¯Ø±Ø³ Ø£Ø­ÙŠØ§Ø¡",
        "image": "https://abqarieno.firebaseapp.com/212.png"
      }
    }
    </script>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YOUR_MEASUREMENT_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-YOUR_MEASUREMENT_ID');
    </script>
</head>
<body>
    <!-- Page Loader -->
    <div id="page-loader">
        <div class="loader-content">
            <i class="fa-solid fa-heart-pulse loader-icon"></i>
            <div class="loader-text">Ø§Ù„Ø¯ÙƒØªÙˆØ± <small>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</small></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="logo">
            <i class="fa-solid fa-heart-pulse"></i>
            <div class="logo-text"><span>Ø§Ù„Ø¯ÙƒØªÙˆØ±</span><small>BIOLOGY MASTER</small></div>
        </div>
        <ul class="nav-links">
            <li><a href="index.html" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="library.html">Ø§Ù„ÙƒØªØ¨</a></li>
            <li><a href="videos.html">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</a></li>
            <li><a href="schedule.html">Ø§Ù„Ø¬Ø¯ÙˆÙ„</a></li>
            <li><a href="reviews.html">ÙˆØ±Ù‚ Ø§Ù„Ø´Ø±Ø­</a></li>
            <li><a href="contact.html">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
        <div style="display:flex; align-items:center; gap:5px;">
            <button id="themeToggle" class="theme-toggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹"><i class="fa-solid fa-moon"></i></button>
            <button id="installAppBtn" class="btn-nav-install" style="display: none;" title="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"><i class="fa-solid fa-download"></i></button>
            <div class="menu-btn"><i class="fa-solid fa-bars"></i></div>
        </div>
    </nav>

    <section class="hero">
        <div class="particles">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="hero-content">
            <div class="hero-text">
                <p class="subtitle scroll-animate" style="transition-delay: 0.1s;">BIOLOGY LAB</p>
                <h1 class="scroll-animate" style="transition-delay: 0.2s;">Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ <br> <span class="neon-green-text">Ø¨Ù…Ù†Ø¸ÙˆØ± Ù…Ø®ØªÙ„Ù</span></h1>
                <p class="hero-desc scroll-animate" style="transition-delay: 0.3s;">Ø§Ø³ØªØ¹Ø¯ Ù„Ø±Ø­Ù„Ø© ÙØ±ÙŠØ¯Ø© ÙÙŠ Ø£Ø¹Ù…Ø§Ù‚ Ø§Ù„Ø®Ù„ÙŠØ© ÙˆØ§Ù„ØªØ´Ø±ÙŠØ­ Ù…Ø¹ Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ . ØªØ¹Ù„ÙŠÙ…Ù†Ø§ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ø­ÙØ¸ØŒ Ø¨Ù„ Ù‡Ùˆ ØªØ¬Ø±Ø¨Ø© Ø¨ØµØ±ÙŠØ© ÙˆØ¹Ù„Ù…ÙŠØ© ØªÙÙˆÙ‚ Ø§Ù„Ø®ÙŠØ§Ù„.</p>
                <div class="hero-btns scroll-animate" style="transition-delay: 0.4s;">
                    <a href="videos.html" class="btn-green">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¢Ù†</a>
                    <a href="library.html" class="btn-outline">ØªØµÙØ­ Ø§Ù„Ù…ÙƒØªØ¨Ø©</a>
                </div>
            </div>
            
            <div class="hero-image scroll-animate" style="transition-delay: 0.5s;">
                <img src="212.png" alt="Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡" class="doctor-img" fetchpriority="high">
            </div>
        </div>
    </section>

    <section class="container">
        <div class="grid-container grid-3" style="padding-top: 50px;">
            <div class="feature-box scroll-animate" style="transition-delay: 0.1s;">
                <i class="fa-solid fa-book-open" style="color:var(--neon-red)"></i>
                <h3>Ù…Ø­ØªÙˆÙ‰ Ø­ØµØ±ÙŠ</h3>
                <p style="color:#888; font-size:0.9rem">ÙƒØªØ¨ ÙˆÙ…Ø°ÙƒØ±Ø§Øª Ø£Ø¹Ø¯Ù‡Ø§ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø®ØµÙŠØµØ§Ù‹ Ù„ØªØ³Ù‡ÙŠÙ„ Ø£ØµØ¹Ø¨ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ….</p>
            </div>
            <div class="feature-box green scroll-animate" style="transition-delay: 0.2s;">
                <i class="fa-regular fa-circle-play"></i>
                <h3>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª 4K</h3>
                <p style="color:#888; font-size:0.9rem">Ø´Ø±ÙˆØ­Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ØªØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ù„Ù„Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§.</p>
            </div>
            <div class="feature-box scroll-animate" style="transition-delay: 0.3s;">
                <i class="fa-solid fa-shield-halved" style="color:var(--neon-red)"></i>
                <h3>ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙ…Ø±</h3>
                <p style="color:#888; font-size:0.9rem">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¯ÙˆØ±ÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙÙˆÙ‚.</p>
            </div>
        </div>
    </section>

    <div class="neon-wrapper" id="registrationModal">
        <div class="registration-card">
            <h2>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø©</h2>
            <p class="warning-text">Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© ÙƒØ§Ù…Ù„Ø©</p>
            <form id="regForm">
                <div class="file-group">
                    <input type="file" id="userPhoto" accept="image/*" required hidden onchange="previewImage(event)">
                    <label for="userPhoto" class="file-upload-label" id="photoLabel">
                        <i class="fa-solid fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <span>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</span>
                    </label>
                    <img id="photoPreview" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; display: none; margin: 0 auto 10px; border: 2px solid var(--neon-green);">
                </div>

                <div class="input-group">
                    <input type="text" id="userName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                </div>
                <div class="input-group">
                    <input type="tel" id="userPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
                </div>
                <div class="input-group gender-group">
                    <div class="radio-options">
                        <input type="radio" id="male" name="gender" value="male" required>
                        <label for="male"><i class="fa-solid fa-mars"></i> ÙˆÙ„Ø¯</label>
                        <input type="radio" id="female" name="gender" value="female" required>
                        <label for="female"><i class="fa-solid fa-venus"></i> Ø¨Ù†Øª</label>
                    </div>
                </div>
                <button type="submit" id="submitBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
            </form>
            <div id="status"></div>
        </div>
    </div>

    <footer>
        <p style="text-align: center;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026 | ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ÙØ±ÙŠÙ‚ Ø¹Ø¨Ù‚Ø±ÙŠÙ†Ùˆ & ÙƒÙŠÙ…Ùˆ <i class="fa-solid fa-heart"></i></p>
    </footer>

    <script src="main.js" defer></script>

    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoLabel').style.display = 'none';
                    const img = document.getElementById('photoPreview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }
    </script>

    <!-- Ø²Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… -->
    <div class="news-float-btn" onclick="openNewsModal()">
        <div class="news-badge" id="newsBadge"></div>
        <i class="fa-solid fa-bell"></i>
        <span>Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span>
    </div>

    <!-- Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Lightbox) -->
    <div id="lightbox-overlay" class="lightbox-overlay">
        <span class="close-lightbox">&times;</span>
        <div class="lightbox-content" id="lightbox-content">
            <!-- Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ (ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ) -->
        </div>
    </div>

    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø§Ø±ÙŠ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØµÙ„) -->
    <div id="fire-notification" class="fire-toast">
        <i class="fa-solid fa-fire-flame-curved"></i>
        <img id="fire-msg-img" src="" alt="Ù…Ø±ÙÙ‚">
        <div>
            <h4>ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¬Ù„ Ù…Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±</h4>
            <small id="fire-msg-text">Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©...</small>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div class="news-modal-overlay" id="newsOverlay">
        <div class="news-modal">
            <div class="news-header">
                <h3><i class="fa-solid fa-bullhorn"></i> Ø¢Ø®Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ±</h3>
                <i class="fa-solid fa-xmark close-news" onclick="closeNewsModal()"></i>
            </div>
            <div class="news-list" id="newsList">
                <p style="text-align:center; color:#666; padding:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</p>
            </div>
            <button onclick="markAsRead()" class="btn-mark-read"><i class="fa-solid fa-check"></i> ØªÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ù†Ø¬Ø§Ø­</button>
            <button onclick="location.href='contact.html'" style="margin-top:15px; width:100%; padding:10px; background:var(--neon-green); border:none; border-radius:8px; font-weight:bold; cursor:pointer;">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØºØ±ÙØ© Ø§Ù„Ø´Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, query, limitToLast, onValue, onChildAdded, get, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD092yeOowtCLW0fDcIzaEXrnxvrN4X5T8",
            authDomain: "abqarieno.firebaseapp.com",
            databaseURL: "https://abqarieno-default-rtdb.firebaseio.com",
            projectId: "abqarieno",
            storageBucket: "abqarieno.firebasestorage.app",
            messagingSenderId: "790682500839",
            appId: "1:790682500839:web:cde37488fc2a4f84e06c42",
            measurementId: "G-8VV9QVEPZK"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        const newsListEl = document.getElementById('newsList');
        const badgeEl = document.getElementById('newsBadge');
        const floatBtn = document.querySelector('.news-float-btn');
        const fireToast = document.getElementById('fire-notification');
        const fireText = document.getElementById('fire-msg-text');
        const fireImg = document.getElementById('fire-msg-img');
        
        const auth = getAuth(app);
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // If you want to protect the main page, uncomment the next line
                // window.location.href = 'auth.html';
            }
        });

        window.logout = () => signOut(auth).then(() => window.location.href = 'auth.html');

        const regForm = document.getElementById('regForm');
        if (regForm) {
            const statusDiv = document.getElementById('status');
            const modal = document.getElementById('registrationModal');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù‡Ù„ Ù‡Ùˆ Ù…Ø«Ø¨ØªØŸ)
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚
            const isRegistered = localStorage.getItem('abqarieno_setup_done');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆÙ‚Ø¹ ÙˆÙŠØ¨ Ø¹Ø§Ø¯ÙŠ (Ù„ÙŠØ³ ØªØ·Ø¨ÙŠÙ‚) Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            if (!isStandalone || isRegistered === 'true') {
                modal.classList.add('hidden');
            }

            regForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„...");
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
                submitBtn.disabled = true;

                try {
                    // 1. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ù‡ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
                    console.log("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
                    const userCredential = await signInAnonymously(auth);
                    const uid = userCredential.user.uid;
                    console.log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ UID:", uid);

                    // 2. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Cloudinary
                    const fileInput = document.getElementById('userPhoto');
                    if (!fileInput.files[0]) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± ØµÙˆØ±Ø© ÙˆØ¬Ù‡Ùƒ");

                    const formData = new FormData();
                    formData.append('file', fileInput.files[0]);
                    formData.append('upload_preset', 'my_chat_preset'); // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Cloudinary ÙˆÙ†ÙˆØ¹Ù‡ Unsigned

                    console.log("Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ Cloudinary...");
                    const cloudRes = await fetch('https://api.cloudinary.com/v1_1/dzwrz9qzb/image/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const cloudData = await cloudRes.json();
                    if (!cloudData.secure_url) throw new Error("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: " + (cloudData.error?.message || "ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary ÙˆØ¹Ù…Ù„ Unsigned Preset"));
                    const imageUrl = cloudData.secure_url;

                    // Get gender value
                    const gender = document.querySelector('input[name="gender"]:checked').value;

                    // 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Realtime Database
                    console.log("Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ ÙØ§ÙŠØ±Ø¨ÙŠØ³...");
                    await set(ref(db, 'users/' + uid), {
                        name: document.getElementById('userName').value,
                        phone: document.getElementById('userPhone').value,
                        gender: gender,
                        faceImage: imageUrl,
                        timestamp: new Date().getTime()
                    });

                    // 4. Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
                    localStorage.setItem('abqarieno_setup_done', 'true');
                    
                    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ù…Ø®ØµØµØ©
                    const userName = document.getElementById('userName').value;
                    alert(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¯ÙƒØªÙˆØ± ${userName} ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø©! ğŸ§¬\nØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.`);
                    
                    statusDiv.innerHTML = `<p style='color: #00ff00; font-weight:bold;'>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${userName}</p>`;
                    regForm.reset();
                    setTimeout(() => modal.classList.add('hidden'), 2000);

                } catch (error) {
                    console.error("Ø­Ø¯Ø« Ø®Ø·Ø£:", error);
                    statusDiv.innerHTML = `<p style='color: red;'>ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${error.message}</p>`;
                    alert("ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + error.message);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerText = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†";
                }
            });
        }

        const lastSeenTime = localStorage.getItem('biology_last_seen_news') || 0;
        const loadTime = Date.now(); // ÙˆÙ‚Øª ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        let latestMsgTimeInModal = 0; // Ù„ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±

        // --- 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø³Ø§Ø¦Ù„ ÙØ§Ø¦ØªØ© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„) ---
        // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        get(query(ref(db, 'broadcasts'), limitToLast(20))).then((snapshot) => {
            if (!snapshot.exists()) return;

            const msgs = Object.values(snapshot.val());
            // Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ø£Ø­Ø¯Ø« Ù…Ù† Ø¢Ø®Ø± Ù…Ø±Ø© Ø´Ø§Ù‡Ø¯ ÙÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø®Ø¨Ø§Ø±ØŸ
            const hasMissedMessages = msgs.some(msg => msg.timestamp > lastSeenTime);

            if (hasMissedMessages) {
                floatBtn.style.display = 'flex';
                badgeEl.classList.add('active');
                floatBtn.classList.add('glowing');
            }
        });

        // --- 2. Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙˆØ±ÙŠØ© (Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙŠ ØªØµÙ„ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙØ§ØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹) ---
        onChildAdded(query(ref(db, 'broadcasts'), limitToLast(1)), (snapshot) => {
            const msg = snapshot.val();
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØµÙ„Øª Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ÙŠÙˆØ²Ø± ÙØ§ØªØ­)
            if (msg.timestamp > loadTime) {
                fireText.textContent = msg.text; // Ø¹Ø±Ø¶ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
                if (msg.mediaURL && msg.mediaType === 'image') {
                    fireImg.src = msg.mediaURL;
                    fireImg.classList.add('show');
                } else {
                    fireImg.classList.remove('show');
                }

                fireToast.classList.add('show');
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø´Ø§Ù‡Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
                localStorage.setItem('biology_last_seen_news', msg.timestamp);
                
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ø®ÙÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                // const audio = new Audio('notification.mp3'); audio.play().catch(()=>{});

                setTimeout(() => {
                    fireToast.classList.remove('show');
                }, 8000); // ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯ 8 Ø«ÙˆØ§Ù†ÙŠ
            }
        });

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø´Ø§Øª
        fireToast.onclick = () => {
            localStorage.setItem('biology_user_role', 'student');
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
            const now = Date.now();
            const current = parseInt(localStorage.getItem('biology_last_seen_news') || '0');
            if(now > current) localStorage.setItem('biology_last_seen_news', now);
            window.location.href = 'contact.html';
        };

        // --- 3. Ù…Ø±Ø§Ù‚Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± (Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ ÙØªØ­Ù‡Ø§) ---
        onValue(query(ref(db, 'broadcasts'), limitToLast(20)), (snapshot) => {
            const data = snapshot.val();
            if (!data) {
                newsListEl.innerHTML = '<p style="text-align:center; color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù…ØµÙÙˆÙØ© ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
            const msgs = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            newsListEl.innerHTML = '';
            let hasNew = false;
            let currentBatchMaxTime = 0;

            // Ù†Ø³ØªØ®Ø¯Ù… lastSeenTime Ø§Ù„Ø°ÙŠ Ù‚Ø±Ø£Ù†Ø§Ù‡ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©

            msgs.forEach(msg => {
                // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙŠ ÙˆØµÙ„Øª Ù„Ù„ØªÙˆ (Ù„Ø£Ù†Ù‡Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù†Ø§Ø±ÙŠ)
                if (msg.timestamp > loadTime) return; 

                const isNew = msg.timestamp > lastSeenTime;
                if (isNew) hasNew = true;
                if (msg.timestamp > currentBatchMaxTime) currentBatchMaxTime = msg.timestamp;

                const dateStr = new Date(msg.timestamp).toLocaleDateString('ar-EG') + ' ' + new Date(msg.timestamp).toLocaleTimeString('ar-EG');
                let mediaHtml = '';
                if (msg.mediaURL) {
                    if (msg.mediaType === 'image') {
                        mediaHtml = `<img src="${msg.mediaURL}" onclick="openLightbox('${msg.mediaURL}', 'image')" style="width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px; margin-top: 8px; border: 1px solid #333; display:block; cursor: pointer; transition: 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'" alt="Ù…Ø±ÙÙ‚ - Ø§Ø¶ØºØ· Ù„Ù„ØªÙƒØ¨ÙŠØ±">`;
                    } else if (msg.mediaType === 'video') {
                        mediaHtml = `<video src="${msg.mediaURL}" class="msg-video" controls preload="metadata"></video>`;
                    } else if (msg.mediaType === 'audio') {
                        mediaHtml = `<audio src="${msg.mediaURL}" controls class="msg-audio"></audio>`;
                    } else {
                        mediaHtml = `<a href="${msg.mediaURL}" target="_blank" class="news-link"><i class="fa-solid fa-paperclip"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ÙÙ‚</a>`;
                    }
                }

                const html = `
                    <div class="news-item ${isNew ? 'new' : ''}">
                        <span class="news-date">${dateStr} ${isNew ? '<span style="color:red; font-weight:bold">(Ø¬Ø¯ÙŠØ¯)</span>' : ''}</span>
                        <div class="news-text">${msg.text}</div>
                        ${mediaHtml}
                    </div>
                `;
                newsListEl.insertAdjacentHTML('beforeend', html);
            });
            
            latestMsgTimeInModal = currentBatchMaxTime;
        });

        // --- 4. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© (Global Scope) ---
        window.openNewsModal = function() {
            document.getElementById('newsOverlay').classList.add('open');
        };

        window.markAsRead = function() {
            if (latestMsgTimeInModal > 0) {
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¥Ù„Ù‰ ÙˆÙ‚Øª Ø£Ø­Ø¯Ø« Ø±Ø³Ø§Ù„Ø© ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                localStorage.setItem('biology_last_seen_news', latestMsgTimeInModal);
            }
            badgeEl.classList.remove('active');
            floatBtn.classList.remove('glowing'); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©
            floatBtn.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            newsListEl.innerHTML = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨ØµØ±ÙŠØ§Ù‹)
            window.closeNewsModal();
        };

        window.closeNewsModal = function() {
            document.getElementById('newsOverlay').classList.remove('open');
        };

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.getElementById('newsOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('newsOverlay')) {
                window.closeNewsModal();
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Lightbox)
        window.openLightbox = function(src, type) {
            const container = document.getElementById('lightbox-content');
            const overlay = document.getElementById('lightbox-overlay');
            
            container.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚
            
            if (type === 'video') {
                container.innerHTML = `<video src="${src}" controls autoplay style="max-width:100%; max-height:90vh; border-radius:10px; box-shadow:0 0 50px rgba(0,255,65,0.2);"></video>`;
            } else {
                const img = document.createElement('img');
                img.src = src;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '90vh';
                img.style.borderRadius = '10px';
                container.appendChild(img);
            }
            
            overlay.classList.add('active');
        };

        window.closeLightbox = function() {
            const overlay = document.getElementById('lightbox-overlay');
            overlay.classList.remove('active');
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            setTimeout(() => {
                document.getElementById('lightbox-content').innerHTML = '';
            }, 400);
        };
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø£Ùˆ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        document.querySelector('.close-lightbox').onclick = closeLightbox;
        document.getElementById('lightbox-overlay').onclick = (e) => {
            if(e.target.id === 'lightbox-overlay') closeLightbox();
        };

    </script>
</body>
</html>